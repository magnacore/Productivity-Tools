#!/usr/bin/env xonsh
import math
from rich.console import Console

console = Console()

import sys
import os
myhome = os.path.expanduser('~')
sys.path.append(f"{myhome}/Bin")

from utilities import get_mime, get_duration, get_filename_extension

# sys.argv[0] is the name of the script which will always be there
selection = False

if len(sys.argv) == 3:
	selection = True

if selection:
	media_to_split = sys.argv[1]
	split_duration = sys.argv[2]

	mimestart = get_mime(media_to_split)

	if mimestart != None:

		if mimestart in ['audio', 'video']:

			duration = get_duration(media_to_split)
			split_duration = float(split_duration)

			parts=int(duration//split_duration)

			filename, extension = get_filename_extension(media_to_split)

			if (mimestart == 'audio') or (extension == ".mka"):
				extension = ".mka"
			elif mimestart == 'video':
				extension = ".mkv"

			new_filename = filename + f'-part' + extension

			if (parts != 0):
				remaining = duration%split_duration
				excess = math.ceil(remaining/parts)
				split_duration_individual = int(split_duration + excess)
				
				mkvmerge -q -o @(new_filename) @(media_to_split) --split duration:@(str(split_duration_individual)+'s')
			else:
				mkvmerge -q -o @(new_filename) @(media_to_split) --split duration:@(str(split_duration)+'s')

