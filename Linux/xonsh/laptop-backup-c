#!/bin/sh
""":"
# This block is run by /bin/sh to find and execute xonsh
exec /home/"$USER"/anaconda3/envs/xonsh/bin/xonsh "$0" "$@"
":"""

from rich.console import Console

console = Console()

console.rule(f"[bold cyan]Laptop Backup B...", style="cyan")

console.print(f"[bold cyan]Deleting previous snapshot...")
sudo btrfs subvolume delete /media/$USER/LAPTOP_BACKUP_C/@previous

console.print(f"[bold cyan]Creating a new read only snapshot...")
sudo btrfs subvolume snapshot -r /media/$USER/LAPTOP_BACKUP_C/@current/ /media/$USER/LAPTOP_BACKUP_C/@previous

console.print(f"[bold cyan]Synchronizing...")
#sudo rsync -vahiP --delete --exclude-from=$HOME/Backups/RSYNC_EXCLUDE/rsync-homedir-local.txt $HOME/ /media/$USER/LAPTOP_BACKUP_C/@current/
sudo rsync -vahiP --delete $HOME/ /media/$USER/LAPTOP_BACKUP_C/@current/

date > ~/.local/state/shortcut/laptop-backup-c.txt
date > /media/$USER/LAPTOP_BACKUP_C/@current/backup_date.txt

# sudo btrfs filesystem show

console.rule(style="cyan")

audio-play ~/.local/bin/oxygen-sound-theme/Oxygen-K3B-Finish-Success.ogg &
