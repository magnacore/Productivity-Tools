#!/home/manuj/anaconda3/envs/xonsh/bin/xonsh
cyan = '\x1b[1;36m'
no_color = '\x1b[0m'

# This script is takes all the videos is the current directory and converts it
# into a format that can be embedded into whatsapp

import os
import glob
import sys
from tqdm import tqdm

myhome = os.path.expanduser('~')
sys.path.append(f"{myhome}/Bin")

from utilities import get_mime

allFiles = glob.glob("*.*")
allFiles.sort()

print(f"{cyan}Converting video...{no_color}")

mkdir converted

for video in tqdm(allFiles):
	mimestart = get_mime(video)

	if mimestart != None:
		if mimestart in ['video']:
			filename = os.path.splitext(video)[0]+' #converted.mp4'

			ffmpeg -i @(video) -c:v libx264 -b:v 300k -pass 1 -n -an -f null /dev/null and \
			ffmpeg -i @(video) -c:v libx264 -b:v 300k -pass 2 -r 30 -vsync vfr -n -c:a aac -b:a 32k -ac 1 f"./converted/{filename}"

rm ffmpeg2pass-0.log.mbtree
rm ffmpeg2pass-0.log

print(u'\u2500' * os.get_terminal_size().columns)

audio-play ~/Bin/oxygen-sound-theme/Oxygen-K3B-Finish-Success.ogg &
