#!/usr/bin/env xonsh
import os
import sys

from rich.console import Console
console = Console()

console.rule(f"[bold cyan]Combining Media...", style="cyan")

# sys.argv[0] is the name of the script which will always be there
selection = False

if len(sys.argv) > 1:
    selection = True

if selection:
    allFiles = sys.argv[1:]
    allFiles.sort()

    temp_filename = 'video_list_temp.txt'

    echo @([f"file \'{filename}\'\n" for filename in allFiles]) > @(temp_filename)

    ffmpeg -safe 0 -f concat -i video_list_temp.txt -c copy combined.mkv

    os.remove(temp_filename)

    # https://github.com/xonsh/xonsh/issues/1307
    # ffmpeg -f concat -i < @([f"file \'{filename}\'\n" for filename in allMediaFiles]) -c copy output.mkv

    audio-play ~/Bin/oxygen-sound-theme/Oxygen-K3B-Finish-Success.ogg &
else:
    console.print("No files selected!", style="bold red")
    audio-play ~/Bin/oxygen-sound-theme/Oxygen-K3B-Finish-Error.ogg &

console.rule(style="cyan")
